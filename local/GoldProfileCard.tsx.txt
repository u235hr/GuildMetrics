// app/components/GoldProfileCard.tsx
'use client';
import React, { useEffect, useRef } from 'react';
import './GoldProfileCard.css';

interface GoldProfileCardProps {
  item: {
    name: string;
    value: string;
    avatar: string;
  };
}

export default function GoldProfileCard({ item }: GoldProfileCardProps) {
  const wrapRef = useRef<HTMLDivElement>(null);
  const cardRef = useRef<HTMLDivElement>(null);

  // ğŸŒ€ 3D è‡ªåŠ¨æ‘†åŠ¨åŠ¨ç”»ï¼ˆä»£æ›¿ hoverï¼‰
  useEffect(() => {
    const wrap = wrapRef.current;
    const card = cardRef.current;
    if (!wrap || !card) return;

    let rafId: number;
    const duration = 4000; // 4ç§’å®Œæˆä¸€ä¸ªå®Œæ•´æ‘†åŠ¨å‘¨æœŸ
    const amplitude = 5;   // æ‘†åŠ¨å¹…åº¦ï¼Œ5åº¦ï¼ˆè½»å¾®æ‘†åŠ¨ï¼‰

    const loop = (timestamp: number) => {
      // è®¡ç®—å½“å‰è¿›åº¦ (0 åˆ° 1)
      const progress = (timestamp % duration) / duration;
      // ä½¿ç”¨æ­£å¼¦å‡½æ•°è®¡ç®—å½“å‰æ—‹è½¬è§’åº¦ï¼Œå®ç°å¹³æ»‘æ¥å›æ‘†åŠ¨
      const angle = Math.sin(progress * Math.PI * 2) * amplitude;

      // å°†è®¡ç®—å¥½çš„è§’åº¦åº”ç”¨åˆ° CSS å˜é‡
      wrap.style.setProperty('--rotate-x', `${angle}deg`);
      wrap.style.setProperty('--rotate-y', `${angle * 0.5}deg`); // Yè½´æ‘†åŠ¨å¹…åº¦å°ä¸€ç‚¹

      rafId = requestAnimationFrame(loop);
    };

    rafId = requestAnimationFrame(loop);

    // ç»„ä»¶å¸è½½æ—¶æ¸…ç†åŠ¨ç”»
    return () => {
      if (rafId) {
        cancelAnimationFrame(rafId);
      }
    };
  }, []); // ç©ºæ•°ç»„ä¾èµ–ï¼Œåªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡

  return (
    // ğŸ‘‡ æ ¹å®¹å™¨ï¼šå¿…é¡»æ˜¯ containerï¼Œå¯ç”¨å®¹å™¨æŸ¥è¯¢
    <div ref={wrapRef} className="medal-card container w-full h-full gold-profile-card-wrapper">
      {/* ğŸ‘‡ å¡ç‰‡æœ¬ä½“ */}
      <section ref={cardRef} className="gold-profile-card">
        <div className="gold-profile-inside">
          {/* å¤´åƒ */}
          <div className="gold-profile-avatar">
            <img
              src={item.avatar}
              alt={`${item.name} avatar`}
              className="avatar"
              loading="lazy"
            />
          </div>

          {/* ç”¨æˆ·ä¿¡æ¯ */}
          <div className="gold-profile-details">
            <h3 className="gold-profile-name">{item.name}</h3>
            <p className="gold-profile-value">ï¿¥{item.value}</p>
          </div>
        </div>
      </section>
    </div>
  );
}